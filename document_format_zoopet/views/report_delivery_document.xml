<?xmove_line version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <template id="report_delivery_document_zoopet" inherit_id="stock.report_delivery_document">

            <xpath expr="//div[@class='page']" position="replace">

                <t t-set="isAlbaran" t-value="o.move_line_ids"></t>

                 <!-- Datos documento -->
              <div style="width:70%;padding-bottom:30px;margin-top:-150px;margin:0px auto;display:none;">

              <h2 style="color:black;margin-left:30%;">
                  <t t-if="not (env.context.get('proforma', False) or is_pro_forma)">
                      <span> Albarán</span>
                  </t>
              </h2>
              <!-- Primera columna -->
              <div style="float:left; width:50%;">
              <div>
                 <span style="width:25%;display:inline-block">Numero :</span><span style="display:inline-block;width:75%;" t-field="o.name"/>
              </div>
              <div>
                 <span style="width:25%;display:inline-block">Fecha :</span><span style="display:inline-block;width:75%;" t-field="o.date_done" t-options="{&quot;format&quot;: &quot;MM-dd-yyyy&quot;}"/>
              </div>
              <div t-if="o.origin">
                 <span style="width:25%;display:inline-block">Pedido: </span><span style="display:inline-block;width:75%;" t-field="o.origin"/>
                </div>
              </div>
              <!-- fin primera columna -->
              <!--Segunda columna -->
              <div  style="float:left; width:50%;">
                <div t-if="o.partner_id.comercial">
                  <span style="width:20%;display:inline-block">Cliente: </span><span style="display:inline-block;width:80%;" t-field="o.partner_id.comercial"/>
                </div>

               <div t-else="">
                  <span style="width:20%;display:inline-block">Cliente: </span><span style="display:inline-block;width:80%;" t-field="o.partner_id.name"/>
                </div>
                <div t-if="o.partner_id.vat">
                  <span style="width:20%;display:inline-block">NIF/CIF: </span><span style="display:inline-block;width:80%;" t-field="o.partner_id.vat"/>
                </div>
                <!-- Fin segunda columna -->
              </div>

            </div>

        <!-- Direcciones -->

            <!-- DIreccion de facturacion -->

            <div style="width:49%;float:left;clear:both;margin-right:1%;border:2px solid black;height:175px;">
              <div style="background-color:blue;color:white;text-align:center;">
                  Dirección de facturacíon
              </div>
              <!-- si es difernte de la de envio -->
                <div t-if="o.partner_id.parent_id" style="margin-left:2%;">
                  <!-- nombre -->
                    <div t-if="o.partner_id.parent_id.name">
                        <span t-field="o.partner_id.parent_id.name"/>
                    </div>
                  <!-- nombre comercial -->
                    <div t-if="o.partner_id.parent_id.comercial">
                       <span t-field="o.partner_id.parent_id.comercial"/>
                    </div>

                 <!-- calle -->
                    <div>
                      <span t-field="o.partner_id.parent_id.street"/>
                    </div>
                 <!-- CP, ciudad -->
                    <div>
                      <span t-if="o.partner_id.parent_id.zip" t-field="o.partner_id.parent_id.zip"/>
                      <span t-if="o.partner_id.parent_id.city" t-field="o.partner_id.parent_id.city"/>
                    </div>
                 <!-- Provincia -->
                    <div>
                      <span t-if="o.partner_id.parent_id.state_id.name" t-field="o.partner_id.parent_id.state_id.name"/>
                    </div>
                 <!-- tlf -->
                    <div>
                      <span t-if="o.partner_id.parent_id.phone">TLF.:</span><span t-if="o.partner_id.parent_id.phone" t-field="o.partner_id.parent_id.phone"/>
                    </div>
                 <!-- CIF/NIF -->
                    <div>
                      <span t-if="o.partner_id.parent_id.vat">NIF/CIF: </span><span  t-if="o.partner_id.parent_id.vat" t-field="o.partner_id.parent_id.vat"/>
                    </div>
                </div>
            <!-- si es la misma -->
                 <div t-if="not o.partner_id.parent_id" style="margin-left:2%;">
                      <!-- nombre -->
                    <div t-if="o.partner_id.name">
                        <span t-field="o.partner_id.name"/>
                    </div>
                  <!-- nombre comercial -->
                    <div t-if="o.partner_id.comercial">
                       <span t-field="o.partner_id.comercial"/>
                    </div>
                 <!-- calle -->
                    <div>
                      <span t-field="o.partner_id.street"/>
                    </div>
                 <!-- CP, ciudad -->
                    <div>
                      <span t-if="o.partner_id.zip" t-field="o.partner_id.zip"/>
                      <span t-if="o.partner_id.city" t-field="o.partner_id.city"/>
                    </div>
                 <!-- Provincia -->
                    <div>
                      <span t-if="o.partner_id.state_id.name" t-field="o.partner_id.state_id.name"/>
                    </div>
                 <!-- tlf -->
                    <div>
                      <span t-if="o.partner_id.phone">TLF.:</span><span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>
                    </div>
                 <!-- CIF/NIF -->
                    <div>
                      <span t-if="o.partner_id.vat">NIF/CIF: </span><span  t-if="o.partner_id.vat" t-field="o.partner_id.vat"/>
                    </div>
                </div>

            </div>

            <!-- Fin direccion de facturacion -->

             <!-- Direccion de envio -->
              <div style="width:49%;float:left;border:2px solid black;margin-left:1%;height:175px;">
                <div style="background-color:blue;color:white;text-align:center;">
                  Dirección de envío
                </div>
                <div t-if="o.partner_id" style="margin-left:2%;">
                    <!-- nombre -->
                    <div t-if="o.partner_id.parent_id.name">
                        <span t-field="o.partner_id.parent_id.name"/>
                    </div>
                    <div t-else="">
                        <span t-field="o.partner_id.name"/>
                    </div>
                  <!-- nombre comercial -->
                    <div t-if="o.partner_id.parent_id.comercial">
                       <span t-field="o.partner_id.parent_id.comercial"/>
                    </div>
                     <div t-else="">
                       <span t-field="o.partner_id.comercial"/>
                    </div>
                 <!-- calle -->
                    <div>
                      <span t-field="o.partner_id.street"/>
                    </div>
                 <!-- CP, ciudad -->
                    <div>
                      <span t-if="o.partner_id.zip" t-field="o.partner_id.zip"/>
                      <span t-if="o.partner_id.city" t-field="o.partner_id.city"/>
                    </div>
                 <!-- Provincia -->
                    <div>
                      <span t-if="o.partner_id.state_id.name" t-field="o.partner_id.state_id.name"/>
                    </div>
                 <!-- tlf -->
                    <div>
                      <span t-if="o.partner_id.phone">TLF.:</span><span t-if="o.partner_id.phone" t-field="o.partner_id.phone"/>
                    </div>
                </div>
            </div>
            <!-- Fin direccion de envio -->
      <!-- Fin direcciones -->
      <!-- Datos documento y observaciones -->
          <!-- datos documento -->
            <div style="width:49%;clear:both;float:left;margin-right:1%;margin-top:5px;font-size:0.9em;">
              <div style="width:50%;float:left;border:2px solid black;height:25px;">
                <span style="margin-left:2px;"><b>Nª Albaran:</b></span><span t-field="o.name"/>
              </div>
              <div style="width:50%;float:left;border-bottom:2px solid black;border-right:2px solid black;border-top:2px solid black;height:25px;">
               <span style="margin-left:2px;"><b>Fecha:</b></span><span t-field="o.date_done" t-options="{&quot;format&quot;: &quot;dd/MM/yyyy&quot;}"/>
              </div>
              <t t-if="o.partner_id.ref">
                  <div style="width:50%;float:left;border-bottom:2px solid black;border-left:2px solid black;border-right:2px solid black;height:25px;">
                      <span style="margin-left:2px;"><b>Cliente:</b></span><span t-field="o.partner_id.ref"></span>
                  </div>
              </t>
              <t t-else="">
                  <t t-if="o.partner_id.parent_id.ref">
                      <div style="width:50%;float:left;border-bottom:2px solid black;border-left:2px solid black;border-right:2px solid black;height:25px;">
                          <span style="margin-left:2px;"><b>Cliente:</b></span><span t-field="o.partner_id.parent_id.ref"></span>
                      </div>
                  </t>
                  <t t-else="">
                      <div style="width:50%;float:left;border-bottom:2px solid black;border-left:2px solid black;border-right:2px solid black;color:white;height:25px;">
                          <span style="margin-left:2px;"><b>Cliente:</b></span>
                      </div>
                  </t>
              </t>
              <div style="width:50%;float:left;border-bottom:2px solid black;border-right:2px solid black;height:25px;">
               <span style="margin-left:2px;"><b>Pedido:</b></span><span t-field="o.origin"/>
              </div>
            </div>
          <!-- fin datos documento -->
          <!-- observaciones -->
            <div style="width:49%;float:left;margin-left:1%;border:2px solid black;height:51px;margin-top:5px;">
                <t t-set="obser" t-value=""></t>
                <t t-set="sale_type" t-value="no_type"></t>
                <t t-foreach="o.move_line_ids" t-as="line">
                    <t t-if="line.move_id.sale_line_id.order_id.note">
                        <t t-set="obser" t-value="line.move_id.sale_line_id.order_id.note"></t>
                    </t>
                    <t t-if="line.move_id.sale_line_id.order_id.type_id">
                        <t t-set="sale_type" t-value="line.move_id.sale_line_id.order_id.type_id.name"></t>
                    </t>
                </t>
                <span style="margin-left:2px;"><b>Observaciones:</b></span><span t-esc="obser"></span>
            </div>
          <!-- fin observaciones -->

      <!-- Fin datos documento -->

                <div style="width:40%;float:left;padding-bottom:30px;">
                <t t-if="partner" name="partner_header">
                    <t t-set="address">
                        <!--<div t-esc="partner" t-options="{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;address&quot;, &quot;name&quot;, &quot;phone&quot;], &quot;no_marker&quot;: True}"/>-->
                   </t>
                </t>
                </div>

                <div class="page" style="margin-top:-500px;">
                   <table class="table table-sm" style="display:none;">
                        <thead>
                            <tr>
                                <th t-if="o.origin"><strong>Order</strong></th>
                                <th name="td_sched_date_h">
                                    <strong>Date</strong>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td t-if="o.origin">
                                    <span t-field="o.origin"/>
                                </td>
                                <td name="td_sched_date">
                                   <t t-if="o.state == 'done'">
                                        <span t-field="o.date_done"/>
                                   </t>
                                   <t t-if="o.state != 'done'">
                                        <span t-field="o.scheduled_date"/>
                                   </t>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm mt48" t-if="o.state!='done'">
                        <thead>
                            <tr>
                                <th><strong>Product</strong></th>
                                <th><strong>Quantity</strong></th>
                            </tr>
                        </thead>
                        <tbody>
                            <t t-set="lines" t-value="o.move_lines.filtered(lambda x: x.product_uom_qty)"/>
                            <tr t-foreach="lines" t-as="move">
                                <td>
                                    <span t-field="move.product_id.name"/>
                                    <p t-if="o.picking_type_code == 'outgoing'">
                                        <span t-field="move.product_id.sudo().description_pickingout"/>
                                    </p>
                                    <p t-if="o.picking_type_code == 'incoming'">
                                        <span t-field="move.product_id.sudo().description_pickingin"/>
                                    </p>
                                </td>
                                <td>
                                    <span t-field="move.product_uom_qty"/>
                                    <span t-field="move.product_uom"/>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <!-- Descuentos -->
               <t t-set="total_discount1" t-value="0"></t>
               <t t-set="total_discount2" t-value="0"></t>
               <t t-set="total_discount3" t-value="0"></t>
               <t t-set="plazos" t-value="0"></t>
               <t t-foreach="o.move_line_ids" t-as="line">
                   <t t-set="line_discount1" t-value="0"></t>
                   <t t-set="line_discount2" t-value="0"></t>
                   <t t-set="line_discount3" t-value="0"></t>
                   <t t-set="unit_price" t-value="line.move_id.sale_line_id.price_unit"></t>
                   <t t-set="plazos" t-value="line.move_id.sale_line_id.order_id.payment_term_id.name"></t>
                   <t t-if="line.product_id">
                       <t t-if="line.move_id.sale_line_id.discount != 0">
                           <t t-set="line_discount1" t-value="(unit_price * line.move_id.sale_line_id.discount /100)*line.move_id.sale_line_id.product_uom_qty"></t>

                           <t t-set="unit_price" t-value="unit_price - unit_price * line.move_id.sale_line_id.discount /100"></t>

                       </t>
                       <t t-if="line.move_id.sale_line_id.discount2 != 0">
                           <t t-set="line_discount2" t-value="(unit_price * line.move_id.sale_line_id.discount2 /100)*line.move_id.sale_line_id.product_uom_qty"></t>

                           <t t-set="unit_price" t-value="unit_price - unit_price * line.move_id.sale_line_id.discount2 /100"></t>
                       </t>
                       <t t-if="line.move_id.sale_line_id.discount3 != 0">
                           <t t-set="line_discount3" t-value="(unit_price * line.move_id.sale_line_id.discount3 /100)*line.move_id.sale_line_id.product_uom_qty"></t>

                           <t t-set="unit_price" t-value="unit_price - unit_price * line.move_id.sale_line_id.discount3 /100"></t>
                       </t>
                       <t t-if="line_discount1 != 0">
                           <t t-set="total_discount1" t-value="total_discount1 + line_discount1"></t>
                       </t>
                       <t t-if="line_discount2 != 0">
                           <t t-set="total_discount2" t-value="total_discount2 + line_discount2"></t>
                       </t>
                       <t t-if="line_discount3 != 0">
                           <t t-set="total_discount3" t-value="total_discount3 + line_discount3"></t>
                       </t>
                   </t>
               </t>

               <!-- fin descuentos -->

                    <!-- Cabecera -->

                       <div style="clear:both;font-size:0.7em;width:100%;">
                          <div style="height:14px; width:10%; display:block; float:left;font-size:1.2em;">
                            <span><b>Código</b></span>
                          </div>
                          <div style="height:14px; width:29%; display:block;float:left;font-size:1.2em;">
                            <span><b>Descripción</b></span>
                          </div>
                          <div style="height:14px; width:7%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <span><b>IVA%</b></span>
                          </div>
                          <div style="height:14px; width:5%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <span><b>UD</b></span>
                          </div>
                          <div style="height:14px; width:9%;  display:block;float:left;font-size:1.2em;text-align:right;">
                            <span><b>Precio/U</b></span>
                          </div>
                          <div style="height:14px; width:8%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <t t-if="total_discount1 != 0">
                                <span><b>DP.</b></span>
                            </t>
                          </div>
                           <div style="height:14px; width:8%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <t t-if="total_discount2 != 0">
                                <span><b>DC.</b></span>
                            </t>
                          </div>
                           <div style="height:14px; width:8%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <t t-if="total_discount3 != 0">
                                <span><b>DPP.</b></span>
                            </t>
                          </div>
                           <div style="height:14px; width:8%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <span><b>Neto</b></span>
                          </div>
                          <div style="height:14px; width:8%;  display:block; float:left;font-size:1.2em;text-align:right;">
                            <span><b>Importe</b></span>
                          </div>
                        </div>



                    <div class="watermark" style="position:absolute;opacity:0.25;font-size:3em;width:100%;text-align:center;z-index:1000;-webkit-transform: rotate(-37deg);margin-top:150px;">
                        <p>*NOTA DE ENTREGA*</p>
                </div>

                <hr style="height:2px;width:110%;background-color:black;margin-left:-15px;margin-top:20px;"></hr>

                    <!-- Fin cabecera -->

                <t t-set="importeTotal" t-value="0"></t>
                <t t-set="importeIva21" t-value="0"></t>
                <t t-set="importeRec52" t-value="0"></t>
                <t t-set="importeIva21Total" t-value="0"></t>
                <t t-set="importeRec52Total" t-value="0"></t>
                <t t-set="importeIva10" t-value="0"></t>
                <t t-set="importeRec14" t-value="0"></t>
                <t t-set="importeIva10Total" t-value="0"></t>
                <t t-set="importeRec14Total" t-value="0"></t>
                <t t-set="importeIva4" t-value="0"></t>
                <t t-set="importeRec05" t-value="0"></t>
                <t t-set="importeIva4Total" t-value="0"></t>
                <t t-set="importeRec05Total" t-value="0"></t>

                <t t-set="weight" t-value="0"></t>

                <!-- lineas -->

                    <div style="width:100%;">

                        <t t-set="has_serial_number" t-value="o.move_line_ids.mapped('lot_id')"/>
                            <t t-set="importeTotal" t-value="0"></t>
                            <t t-foreach="o.move_line_ids" t-as="move_line">


                             <div style="font-size:0.7em;">
                             <!-- codigo -->
                                <div style="width:10%; display:block;clear:both; float:left;height:16px;margin-top:-10px;">
                                  <span t-field="move_line.move_id.sale_line_id.product_id.default_code"/>
                                </div>
                             <!-- Fin codigo -->
                             <!-- Descripcion -->
                                <div style="width:29%; display:block;float:left;margin-top:-10px;">
                                    <!--<span t-field="move_line.move_id.sale_line_id.name"/> -->
                                    <p t-if="o.picking_type_code == 'outgoing'">
                                        <span t-field="move_line.move_id.sale_line_id.name"/>
                                    </p>
                                    <p t-if="o.picking_type_code == 'incoming'">
                                        <span t-field="move_line.product_id.sudo().description_pickingin"/>
                                    </p>
                                </div>
                              <!-- Fin descripcion -->
                              <!-- % de IVA -->

                                <div style="width:7%;  display:block; float:left;text-align:right;margin-top:-10px;">
                                    <t t-set="IVALin" t-value="0"></t>
                                    <t t-f="move_line.move_id.sale_line_id.tax_id">
                                    <t t-foreach="move_line.move_id.sale_line_id.tax_id" t-as="tax">
                                      <t t-set="tax_name" t-value="tax.name"></t>
                                      <t t-set="isIVA" t-value="tax_name.find('IVA')"></t>
                                     <t t-if="isIVA > -1">
                                         <t t-if="tax.amount != 0.00">
                                            <t t-set="IVALin" t-value="'%.2f'%tax.amount"></t>
                                        </t>
                                     </t>
                                      <t t-else="">

                                      </t>

                                  </t>
                                  <t t-if="IVALin != 0.00">

                                    <span t-esc="IVALin"></span>
                                  </t>
                                  <t t-else="">
                                    <span style="color:white;">a</span>
                                  </t>

                                    </t>

                                </div>
                              <!-- Fin % de IVA -->

                              <!-- Cantidad entregada -->
                                <div style="width:5%;  display:block; float:left;text-align:right;margin-top:-15px">
                                     <span t-esc="'%.2f'%move_line.move_id.sale_line_id.qty_delivered"/>
                                </div>
                              <!-- Fin cantidad entregada -->

                              <!--Precio / U -->
                                <div style="width:9%;  display:block;float:left; text-align:right;margin-top:-15px">
                                      <t t-if="move_line.move_id.sale_line_id">
                                        <span t-esc="'%.2f'%move_line.move_id.sale_line_id.price_unit"/>€
                                    </t>
                                    <t t-if="move_line.move_id.purchase_line_id">
                                        <span t-esc="'%.2f'%move_line.move_id.purchase_line_id.price_unit"/>€
                                    </t>
                                </div>
                              <!-- Fin precio / u -->

                              <!-- Descuento1 -->
                                <div t-if="move_line.move_id.sale_line_id.discount != 0.00" style="width:8%;display:block; float:left;text-align:right;margin-top:-15px">
                                      <span t-esc="'%.2f'%move_line.move_id.sale_line_id.discount"/>
                                </div>
                                <div t-else="" style="width:8%;display:block; float:left;text-align:right;margin-top:-15px">
                                     <span style="color:white;">a</span>
                                </div>
                              <!-- Fin descuento1 -->

                               <!-- Descuento2 -->
                                <div t-if="move_line.move_id.sale_line_id.discount2 != 0.00" style="width:8%;  display:block; float:left;text-align:right;margin-top:-15px">
                                      <span t-esc="'%.2f'%move_line.move_id.sale_line_id.discount2"/>
                                </div>
                                <div t-else="" style="width:8%;display:block; float:left;text-align:right;margin-top:-15px">
                                     <span style="color:white;">a</span>
                                </div>
                              <!-- Fin descuento2 -->

                                 <!-- Descuento3 -->
                                <div t-if="move_line.move_id.sale_line_id.discount3 != 0.00" style="width:8%;  display:block; float:left;text-align:right;margin-top:-15px">
                                      <span t-esc="'%.2f'%move_line.move_id.sale_line_id.discount3"/>
                                </div>
                                <div t-else="" style="width:8%;display:block; float:left;text-align:right;margin-top:-15px">
                                     <span style="color:white;">a</span>
                                </div>
                              <!-- Fin descuento3 -->

                              <!-- Precio Neto / u -->
                                <div style="width:8%;  display:block; float:left;text-align:right;margin-top:-15px">
                                     <span t-esc="'%.2f'%move_line.move_id.sale_line_id.price_reduce"/>€
                                </div>
                              <!-- Fin precio neto / u -->

                              <!-- Precio total linea -->
                                <div style="width:8%;  display:block; float:left;text-align:right;margin-top:-15px">
                                    <t t-if="move_line.move_id.sale_line_id.discount">
                                    <t t-set="discount" t-value="move_line.move_id.sale_line_id.price_unit*move_line.move_id.sale_line_id.discount/100"></t>
                                    <t t-set="price_discount" t-value="move_line.move_id.sale_line_id.price_unit - discount"></t>
                                    <t t-if="move_line.move_id.sale_line_id.discount2">
                                         <t t-set="discount2" t-value="price_discount*move_line.move_id.sale_line_id.discount2/100"></t>
                                        <t t-set="price_discount" t-value="round(price_discount - discount2,2)"></t>
                                    </t>
                                   <t t-if="move_line.move_id.sale_line_id.discount3">
                                         <t t-set="discount3" t-value="price_discount*move_line.move_id.sale_line_id.discount3/100"></t>
                                        <t t-set="price_discount" t-value="round(price_discount - discount3,2)"></t>
                                    </t>
                                     <t t-set="total_linea" t-value="round(price_discount*move_line.qty_done,2)"></t>
                                    <t t-set="importeTotal"
                                t-value="importeTotal + total_linea"></t>
                                </t>
                                <t t-else="">
                                     <t t-set="total_linea" t-value="round(move_line.move_id.sale_line_id.price_unit*move_line.qty_done,2)"></t>
                                    <t t-set="importeTotal"
                                    t-value="importeTotal + total_linea"></t>
                                </t>
                                     <t t-if="move_line.move_id.sale_line_id">

                                        <span t-esc="'%.2f'%total_linea"/>€
                                    </t>
                                    <t t-if="move_line.move_id.purchase_line_id">
                                        <span t-esc="'%.2f'%(move_line.move_id.purchase_line_id.price_unit*move_line.qty_done)"/>€
                                    </t>
                                    <t t-if="move_line.move_id.sale_line_id.product_id.weight">
                                        <t t-set="weight" t-value="weight + move_line.move_id.sale_line_id.product_id.weight * move_line.move_id.sale_line_id.qty_delivered"></t>
                                    </t>
                                </div>
                                 
                                  <t t-if="move_line.move_id.sale_line_id">
                              <!-- <t t-if="move_line.move_id.sale_line_id.discount">
                                    <t t-set="discount" t-value="move_line.move_id.sale_line_id.price_unit*move_line.move_id.sale_line_id.discount/100"></t>
                                    <t t-set="price_discount" t-value="move_line.move_id.sale_line_id.price_unit - discount"></t>
                                    <t t-if="move_line.move_id.sale_line_id.discount2">
                                         <t t-set="discount2" t-value="price_discount*move_line.move_id.sale_line_id.discount2/100"></t>
                                        <t t-set="price_discount" t-value="round(price_discount - discount2,2)"></t>
                                    </t>
                                   <t t-if="move_line.move_id.sale_line_id.discount3">
                                         <t t-set="discount3" t-value="price_discount*move_line.move_id.sale_line_id.discount3/100"></t>
                                        <t t-set="price_discount" t-value="round(price_discount - discount3,2)"></t>
                                    </t>
                                     <t t-set="total_linea" t-value="round(price_discount*move_line.qty_done,2)"></t>
                                    <t t-set="importeTotal"
                                t-value="importeTotal + total_linea"></t>
                                </t>
                                <t t-else="">
                                     <t t-set="total_linea" t-value="round(move_line.move_id.sale_line_id.price_unit*move_line.qty_done,2)"></t>
                                    <t t-set="importeTotal"
                                    t-value="importeTotal + total_linea"></t>
                                </t>-->

                            </t>

                            <t t-if="move_line.move_id.purchase_line_id">
                                <t t-if="move_line.move_id.purchase_line_id.discount">
                                    <t t-set="discount" t-value="move_line.move_id.purchase_line_id.price_unit*move_line.move_id.purchase_line_id.discount/100"></t>
                                    <t t-set="price_discount" t-value="move_line.move_id.purchase_line_id.price_unit - discount"></t>
                                    <t t-if="move_line.move_id.purchase_line_id.discount2">
                                         <t t-set="discount2" t-value="price_discount*move_line.move_id.purchase_line_id.discount2/100"></t>
                                        <t t-set="price_discount" t-value="price_discount - discount2"></t>
                                    </t>

                                     <t t-set="total_linea" t-value="round(price_discount*move_line.qty_done,2)"></t>
                                    <t t-set="importeTotal"
                                t-value="importeTotal + total_linea"></t>
                                </t>
                                <t t-else="">
                                     <t t-set="total_linea" t-value="round(move_line.move_id.purchase_line_id.price_unit*move_line.qty_done,2)"></t>
                                    <t t-set="importeTotal"
                                    t-value="importeTotal + total_linea"></t>
                                </t>

                            </t>

                                 

                               <!-- <t t-set="importeTotal" t-value="importeTotal + (move_line.move_id.sale_line_id.price_reduce*move_line.move_id.sale_line_id.qty_delivered)"></t> -->


                              <!-- Fin precio total de linea -->
                                  <!-- IVA -->


                            <div class="text-right"
                                 style="float:left;width:5%;">

                                <t t-if="move_line.move_id.sale_line_id">
                                    <t t-foreach="move_line.move_id.sale_line_id.tax_id" t-as="tax">
                                        <t t-set="tax_name" t-value="tax.name"></t>
                                        <t t-set="isIVA" t-value="tax_name.find('IVA')"></t>


                                        <!-- acumulacion de las cantidad de cada iva ventas -->

                                        <t t-if="tax.amount == 21.0">
                                            <t t-set="importeIva21"
                                               t-value="importeIva21 +(total_linea*0.21 )"></t>
                                            <t t-set="importeIva21Total"
                                               t-value="importeIva21Total +total_linea"></t>
                                        </t>
                                        <t t-if="tax.amount == 5.2">
                                            <t t-set="importeRec52"
                                               t-value="importeRec52 + total_linea *0.052"></t>
                                        </t>

                                        <t t-if="tax.amount == 10.0">
                                            <t t-set="importeIva10"
                                               t-value="importeIva10 +(total_linea*0.10 )"></t>
                                            <t t-set="importeIva10Total"
                                               t-value="importeIva10Total +total_linea"></t>
                                        </t>

                                         <t t-if="tax.amount == 1.4">
                                            <t t-set="importeRec14"
                                               t-value="importeRec14 +total_linea *0.014"></t>
                                        </t>

                                        <t t-if="tax.amount == 4.0">
                                            <t t-set="importeIva4"
                                               t-value="importeIva4 +(total_linea*0.04 )"></t>
                                            <t t-set="importeIva4Total"
                                               t-value="importeIva4Total +total_linea"></t>
                                        </t>

                                        <t t-if="tax.amount == 0.50">
                                            <t t-set="importeRec05"
                                               t-value="importeRec05 +total_linea *0.005"></t>
                                        </t>


                                        <!-- fin acumulaciones de las cantuidades de iva ventas -->

                                    </t>
                                </t>
                                <t t-if="move_line.move_id.purchase_line_id">
                                    <t t-foreach="move_line.move_id.purchase_line_id.taxes_id" t-as="tax">
                                        <t t-set="tax_name" t-value="tax.name"></t>
                                        <t t-set="isIVA" t-value="tax_name.find('IVA')"></t>


                                        <!-- acumulacion de las cantidad de cada iva compras -->

                                        <t t-if="tax.amount == 21.0">
                                            <t t-set="importeIva21"
                                               t-value="importeIva21 +(total_linea*0.21 )"></t>
                                            <t t-set="importeIva21Total"
                                               t-value="importeIva21Total +total_linea"></t>

                                        </t>

                                        <t t-if="tax.amount == 10.0">
                                            <t t-set="importeIva10"
                                               t-value="importeIva10 +(total_linea*0.10 )"></t>
                                            <t t-set="importeIva10Total"
                                               t-value="importeIva10Total +total_linea"></t>

                                        </t>

                                        <t t-if="tax.amount == 4.0">
                                            <t t-set="importeIva4"
                                               t-value="importeIva4 +(total_linea*0.04 )"></t>
                                            <t t-set="importeIva4Total"
                                               t-value="importeIva4Total +total_linea"></t>

                                        </t>


                                        <!-- fin acumulaciones de las cantuidades de iva compras -->

                                    </t>
                                </t>

                            </div>


                           <!-- <div t-else="" style="width:55px;;display:block; float:left;">
                                <span style="color:white">aaa</span>
                            </div> -->

                            <!-- Fin IVA -->

                           </div>
                            </t>
                        </div>

                        <hr style="height:2px;width:110%;background-color:black;margin-left:-15px;clear:both;"></hr>

                <!-- Fin productos -->

                    <!-- calculo del total -->

                            <t t-set="importeTotalIva" t-value="0"></t>
                            <t t-if="importeIva21 != 0">
                                <t t-set="importeTotalIva" t-value="importeTotalIva + round(importeIva21,2)"></t>
                            </t>

                            <t t-if="importeRec52 != 0">
                                <t t-set="importeTotalIva" t-value="importeTotalIva + round(importeRec52,2)"></t>
                            </t>

                            <t t-if="importeIva10">
                                <t t-set="importeTotalIva" t-value="importeTotalIva + round(importeIva10,2)"></t>
                            </t>

                            <t t-if="importeRec14">
                                <t t-set="importeTotalIva" t-value="importeTotalIva + round(importeRec14,2)"></t>
                            </t>

                            <t t-if="importeIva4">
                                <t t-set="importeTotalIva" t-value="importeTotalIva + round(importeIva4,2)"></t>
                            </t>

                            <t t-if="importeRec05">
                                <t t-set="importeTotalIva" t-value="importeTotalIva + round(importeRec05,2)"></t>
                            </t>

                            <t t-set="importeTotalImp" t-value="importeTotal + round(importeTotalIva,2)"></t>

                    <!-- fin calculo del total -->

                    <!-- Desglose -->

                  <!-- Descuentos aplicados -->
                <div style="width:40%;margin-right:10%;float:left;font-size:0.8em;">
                  <div t-if="total_discount1 != 0">
                       <div style="width:50%;float:left;">
                           <span>Total descuento Producto</span>
                       </div>
                       <div style="width:50%;float:left;text-align:right;">
                           -<span t-esc="'%.2f'%total_discount1"></span>€
                       </div>
                  </div>
                  <div t-if="total_discount2 != 0">
                       <div style="width:50%;float:left;">
                           <span>Total descuento Cliente</span>
                       </div>
                       <div style="width:50%;float:left;text-align:right;">
                           -<span t-esc="'%.2f'%total_discount2"></span>€
                       </div>
                  </div>
                  <div t-if="total_discount3 != 0">
                       <div style="width:50%;float:left;">
                           <span>Total descuento PP</span>
                       </div>
                       <div style="width:50%;float:left;text-align:right;">
                           -<span t-esc="'%.2f'%total_discount3"></span>€
                       </div>
                  </div>
                    <hr t-if="total_discount3 != 0 or total_discount2 != 0 or total_discount1 != 0" style="height:2px;width:100%;background-color:black;"></hr>
                     <div t-if="total_discount3 != 0 or total_discount2 != 0 or total_discount1 != 0">
                       <div style="width:50%;float:left;margin-top:-15px;">
                           <span>Total descuentos</span>
                       </div>

                       <div style="width:50%;float:left;text-align:right;margin-top:-15px;">
                           <t t-set="total_discounts" t-value="0"></t>
                           <t t-if="total_discount1 != 0">
                               <t t-set="total_discounts" t-value="total_discounts + total_discount1"></t>
                           </t>
                           <t t-if="total_discount2 != 0">
                               <t t-set="total_discounts" t-value="total_discounts + total_discount2"></t>
                           </t>
                           <t t-if="total_discount3 != 0">
                               <t t-set="total_discounts" t-value="total_discounts + total_discount3"></t>
                           </t>
                           -<span t-esc="'%.2f'%total_discounts"></span>€
                       </div>
                  </div>

                </div>

              <!-- Fin descuentos aplicados -->

                <div style="width:40%;margin-left:8%;float:right;font-size:0.8em;">

              <!-- Base imponible -->

                    <div style="width:50%;float:left;">
                           <span>Base imponible</span>
                       </div>
                       <div style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeTotal"></span>€
                       </div>
               <!-- Fin base imponible -->

               <!-- desglose de Impuestos -->

                     <div  t-if="importeIva21Total != 0" style="width:50%;float:left;">
                           <span>IVA 21% en </span><span t-esc="'%.2f'%importeIva21Total"></span>
                       </div>
                       <div t-if="importeIva21Total != 0" style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeIva21"></span>€
                       </div>

                       <div  t-if="importeRec52 != 0" style="width:50%;float:left;">
                           <span>R.E. 5.2% en </span><span t-esc="'%.2f'%importeIva21Total"></span>
                       </div>
                       <div t-if="importeRec52 != 0" style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeRec52"></span>€
                       </div>

                        <div  t-if="importeIva10Total != 0" style="width:50%;float:left;">
                           <span>IVA 10% en </span><span t-esc="'%.2f'%importeIva10Total"></span>
                       </div>
                       <div t-if="importeIva10Total != 0" style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeIva10"></span>€
                       </div>

                        <div  t-if="importeRec14 != 0" style="width:50%;float:left;">
                           <span>R.E. 1.4% en </span><span t-esc="'%.2f'%importeIva10Total"></span>
                       </div>
                       <div t-if="importeRec14 != 0" style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeRec14"></span>€
                       </div>

                    <div  t-if="importeIva4Total != 0" style="width:50%;float:left;">
                           <span>IVA 4% en </span><span t-esc="'%.2f'%importeIva4Total"></span>
                       </div>
                       <div t-if="importeIva4Total != 0" style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeIva4"></span>€
                       </div>

                        <div  t-if="importeRec05 != 0" style="width:50%;float:left;">
                           <span>R.E. 0.5% en </span><span t-esc="'%.2f'%importeIva4Total"></span>
                       </div>
                       <div t-if="importeRec05 != 0" style="width:50%;float:left;text-align:right;">
                           <span t-esc="'%.2f'%importeRec05"></span>€
                       </div>

               <!-- Fin desglose impuestos -->

                <!-- Total -->

                <div style="width:50%;float:left;">
                           <b><span>Total </span></b>
                       </div>
                       <div style="width:50%;float:left;text-align:right;">
                           <t t-set="importe_total_doc" t-value="importeTotal"></t>
                           <t t-if="importeIva21Total != 0">
                               <t t-set="importe_total_doc" t-value="importe_total_doc+importeIva21"></t>
                               <t t-if="importeRec52 != 0">
                                   <t t-set="importe_total_doc" t-value="importe_total_doc+importeRec52"></t>
                               </t>
                           </t>
                           <t t-if="importeIva10Total != 0">
                               <t t-set="importe_total_doc" t-value="importe_total_doc+importeIva10"></t>
                               <t t-if="importeRec14 != 0">
                                   <t t-set="importe_total_doc" t-value="importe_total_doc+importeRec14"></t>
                               </t>
                           </t>
                           <t t-if="importeIva4Total != 0">
                               <t t-set="importe_total_doc" t-value="importe_total_doc+importeIva4"></t>
                               <t t-if="importeRec05 != 0">
                                   <t t-set="importe_total_doc" t-value="importe_total_doc+importeRec05"></t>
                               </t>
                           </t>

                           <b><span t-esc="'%.2f'%importe_total_doc"></span>€</b>
                       </div>
              <!-- Fin Desglose -->

                    <hr style="height:2px;width:100%;background-color:black;"></hr>
                </div>

                    <!-- Portes -->
                    <t t-if="o.carrier_id.name">
                        <t t-set="carrier_delivery" t-value="o.carrier_id.name"></t>
                    </t>

                   <!-- <div t-if="o.carrier_id" style="clear:both;margin-top:30px;">
                     <span>Método de Envío: </span><b><span t-field="o.carrier_id.name"/></b>
                    </div> -->
                    <!-- Fin portes -->

                      <!-- Plazos de pago -->
                    <!--<div t-if="plazos" style="clear:both;margin-top:30px;">
                      <span>Plazos de Pago: </span><b><span t-esc="plazos"/></b>
                    </div>-->

                    <!-- Fin plazos pago -->

                    <!-- Peso -->

                    <!--<t t-if="weight != 0">
                        <div style="clear:both;">
                            <b><span t-esc="'%.4f'%weight"></span></b>
                        </div>
                        </t>-->
                    <!-- Fin peso -->

                    <!-- Leyenda Factura -->
                   <!-- <div>
                      <span style="display:block;clear:both;" >Las incidencias en transporte (roturas, falta de mercancía, etc.), deberán ser comunicadas antes de 24 horas.</span>
                    </div>-->

                    <!-- Fin leyenda Factura -->
                    <p>
                        <t t-if="o.backorder_ids and o.backorder_ids.filtered(lambda x: x.state not in ('done', 'cancel'))">
                            All items couldn't be shipped, the remaining ones will be shipped as soon as they become available.
                        </t>
                    </p>
                </div>

            </xpath>

        </template>

    </data>

</odoo>
